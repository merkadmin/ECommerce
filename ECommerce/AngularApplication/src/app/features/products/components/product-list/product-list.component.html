<div class="product-list-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Products</h1>
      <p class="page-subtitle">Compare prices across retailers and find the best deals</p>
    </div>

    <div class="header-actions">
      <!-- Search -->
      <app-cr-input
        class="header-search"
        placeholder="Search products..."
        [hasClearBtn]="true"
        [hasInputIcon]="true"
        (inputObserverWithTimeDelay)="onSearchSetup($event)"
        (onClear)="onSearchClear()">
        <i crInputIcon class="icon-search"></i>
      </app-cr-input>

      <!-- View Toggle -->
      <div class="view-toggle">
        <button
          class="toggle-btn"
          [class.active]="viewMode === 'grid'"
          (click)="viewMode = 'grid'"
          title="Grid view">
          <i class="icon-grid"></i>
        </button>
        <button
          class="toggle-btn"
          [class.active]="viewMode === 'list'"
          (click)="viewMode = 'list'"
          title="List view">
          <i class="icon-list"></i>
        </button>
      </div>

      <!-- Filter Toggle (Mobile) -->
      <button class="filter-toggle-btn" (click)="toggleFilters()">
        <i class="icon-filter"></i>
        Filters
      </button>
    </div>
  </div>

  <div class="page-content">
    <!-- Filters Sidebar -->
    <aside class="filters-sidebar" [class.show]="showFilters">
      <div class="filters-header">
        <h3>Filters</h3>
        <button class="clear-filters" (click)="clearFilters()" *ngIf="filter.categoryId || filter.minPrice || filter.retailerIds?.length">
          Clear all
        </button>
      </div>

      <!-- Categories -->
      <div class="filter-section">
        <h4 class="filter-title">Category</h4>
        <ul class="filter-list">
          <li *ngFor="let category of categories">
            <label class="filter-checkbox">
              <input
                type="radio"
                name="category"
                [value]="category.id"
                [(ngModel)]="filter.categoryId"
                (change)="onFilterChange()"
              />
              <span class="checkbox-label">{{ category.name }}</span>
              <span class="filter-count">{{ category.productCount }}</span>
            </label>
          </li>
        </ul>
      </div>

      <!-- Price Range -->
      <div class="filter-section">
        <h4 class="filter-title">Price Range</h4>
        <ul class="filter-list">
          <li *ngFor="let range of priceRanges">
            <label class="filter-checkbox">
              <input
                type="radio"
                name="priceRange"
                [value]="range"
                (change)="onPriceRangeSelect(range)"
              />
              <span class="checkbox-label">{{ range.label }}</span>
            </label>
          </li>
        </ul>

        <!-- Custom Price Range -->
        <div class="custom-price-range">
          <input
            type="number"
            class="price-input"
            placeholder="Min"
            [(ngModel)]="filter.minPrice"
            (change)="onFilterChange()"
          />
          <span class="price-separator">-</span>
          <input
            type="number"
            class="price-input"
            placeholder="Max"
            [(ngModel)]="filter.maxPrice"
            (change)="onFilterChange()"
          />
        </div>
      </div>

      <!-- Retailers -->
      <div class="filter-section">
        <h4 class="filter-title">Retailers</h4>
        <ul class="filter-list">
          <li *ngFor="let retailer of retailers">
            <label class="filter-checkbox">
              <input
                type="checkbox"
                [value]="retailer.id"
                [checked]="filter.retailerIds?.includes(retailer.id)"
                (change)="onFilterChange()"
              />
              <span class="checkbox-label">{{ retailer.name }}</span>
              <span class="filter-count">{{ retailer.productCount }}</span>
            </label>
          </li>
        </ul>
      </div>
    </aside>

    <!-- Products Grid -->
    <div class="products-container">
      <!-- Toolbar -->
      <div class="products-toolbar">
        <div class="results-count">
          <span *ngIf="!isLoading">{{ totalProducts }} products found</span>
          <span *ngIf="isLoading">Loading...</span>
        </div>

        <div class="toolbar-actions">
          <!-- Sort -->
          <div class="sort-select">
            <label>Sort by:</label>
            <select [(ngModel)]="filter.sortBy" (change)="onSortChange(filter.sortBy!)">
              <option *ngFor="let option of sortOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Compare Bar -->
      <div class="compare-bar" *ngIf="compareIds.size > 0">
        <span>{{ compareIds.size }} product(s) selected for comparison</span>
        <button class="btn btn-primary" [routerLink]="['/products/compare']" [queryParams]="{ids: getCompareIds()}">
          Compare Now
        </button>
        <button class="btn btn-ghost" (click)="compareIds.clear()">Clear</button>
      </div>

      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading">
        <div class="skeleton-grid">
          <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5,6,7,8]"></div>
        </div>
      </div>

      <!-- Products Grid -->
      <div
        class="products-grid"
        [class.list-view]="viewMode === 'list'"
        *ngIf="!isLoading && products.length > 0">
        <app-product-card
          *ngFor="let product of products"
          [product]="product"
          [isInWishlist]="isInWishlist(product.id)"
          [isInCompare]="isInCompare(product.id)"
          (addToWishlist)="onAddToWishlist($event)"
          (removeFromWishlist)="onRemoveFromWishlist($event)"
          (addToCompare)="onAddToCompare($event)"
          (removeFromCompare)="onRemoveFromCompare($event)"
          (setAlert)="onSetAlert($event)"
          (viewDetails)="onViewDetails($event)">
        </app-product-card>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!isLoading && products.length === 0">
        <i class="icon-search-off"></i>
        <h3>No products found</h3>
        <p>Try adjusting your search or filter criteria</p>
        <button class="btn btn-primary" (click)="clearFilters()">Clear Filters</button>
      </div>

      <!-- Pagination -->
      <app-pagination
        *ngIf="totalProducts > filter.pageSize"
        [total]="totalProducts"
        [page]="filter.page"
        [recordPerPage]="filter.pageSize"
        (changePagination)="onPaginationChange($event)">
      </app-pagination>
    </div>
  </div>
</div>
